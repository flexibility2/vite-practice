# vite-practice

# 面试考点

## vite 的核心概念

1. 快速冷启动
2. 即时热更新
3. 原生 ES 模块支持
4. 插件体系
5. 按需编译
6. 生产构建优化
7. 环境变量
8. 现代浏览器支持

## 说下 vite 为什么开发环境使用 esbuild，线上构建使用 rollup？

## 说说你对 bundless 的理解？

# 基础概念

1. vite 配置里面没有 entry，入口默认是 src
   vite 默认是 web 应用， **index.html 的 type="module",src=""**是入口文件。但是只能处理 js 文件

2. vite 在开发环境使用的 esbuild 进行编译，代码转换和优化，esbuild 是用 go 语言编写的，性能非常高，能够极大提升冷启动速度和热更新速度。esbuild 支持 js，ts，react，vue 等多种语言和框架。
   之前的 js 的使用的 Babel 是不行的，Babel 是用 js 编写的，性能较低，无法满足 vite 对性能的要求。
   vite 里面装的 react，vue 的插件只是用来做优化的

   对于样式文件，vite 使用 postcss 进行处理，postcss 是用 js 编写的，性能较低，但是样式文件的处理时间相对较短，对整体性能影响不大。

   综上，在模块解析时，vite 是按照需要进行解析，并会将结果缓存起来，避免重复解析，提高性能。

3. 另外一些配置

- 针对性功能增加，plugin 配置
- 模块解析，resolve
- 本地开发构建服务，server
- 样式额外处理，css 配置
- vite 环境变量，define 配置（一般用 env 文件，.env， 且以 VITE 开头的变量）
- 产物构建，build，esbuild 配置

## vite 的插件体系

和 webpack 不同
webpack 的插件是用来强化构建过程，通过暴露的插件时机钩子在不同的时机做一些处理
需要和 loader 区分开。loader 的工作是模块编译和解析，插件是用于功能增强。

vite 的插件本质是一个函数。
vite 没有 loader，但是 vite 插件在开发服务启动时，会调用 Rollup 的构建钩子：
options
buildStart
resolveId,load, transform
允许插件在不同的阶段介入构建过程

vite 的插件体系是基于 rollup 的插件体系进行扩展的，vite 插件可以使用 rollup 插件，也可以使用 vite 专用的插件。vite 插件可以分为两类，一类是开发环境插件，一类是生产环境插件。开发环境插件主要用于处理模块解析，热更新等功能，生产环境插件主要用于代码压缩，优化等功能。vite 插件可以通过配置文件进行配置，也可以通过命令行参数进行配置。

## vite 的原理

**借助了浏览器的 module 支持**。会开一个服务，把代码以模块的形式提供给浏览器。

浏览器请求模块时，vite 会根据请求的模块路径，找到对应的文件，并进行编译和转换，然后将编译后的代码返回给浏览器。浏览器接收到代码后，会进行解析和执行。vite 会对模块进行按需编译，只有当模块被请求时，才会进行编译和转换，这样可以大大提高冷启动速度和热更新速度。
**需要编译的内容做额外的编译处理** css,ts

**两端**

- 本地通过开发服务器借助 esbuild 实现
- Rollup 打包

例子：

1. 插件处理 config，配置问题，比如修改端口
2. 插件处理编译工作, generateBundle
3. 插件处理编译内容输出，transform

## 整体架构设计

- 开发服务器
- 模块解析与热更新
- 构建工具链（生产环境 Rollup 打包）
- 插件系统

### 开发服务器原理

Vite 的开发服务器是基于 Node.js 的 http 模块实现的。它会监听文件系统的变化，当文件发生变化时，会通知浏览器进行热更新。

- 启动服务器时，createServer 会创建一个 http 服务器，并监听指定的端口。
  vite 会扫描项目目录下的所有文件，并建立一个文件映射表，用于快速定位文件路径。
- 处理请求: 添加中间件，包括静态资源处理，模块解析，热更新等功能。

### 模块解析与转化

- 模块解析，使用 es-module-lexer 进行静态分析，提取模块的导入导出信息。
- 模块转化，使用 esbuild 进行代码转换和优化。
- 缓存机制，vite 会对编译后的模块进行缓存，避免重复编译，提高性能。
- 文件类型处理，通过 plugins 处理不同类型的文件，如 vue，react，css 等。

### 构建工具链

- 生产环境使用 Rollup 进行打包构建。TreeShaking 是 Rollup 的核心功能之一，可以有效减少最终产物的体积。
- 代码分割，Rollup 支持动态导入，可以实现代码分割，
